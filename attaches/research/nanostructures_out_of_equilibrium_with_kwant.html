<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Nanostructures out of equilibrium with KWANT</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="nanostructures_out_of_equilibrium_with_kwant_files/libs/clipboard/clipboard.min.js"></script>
<script src="nanostructures_out_of_equilibrium_with_kwant_files/libs/quarto-html/quarto.js"></script>
<script src="nanostructures_out_of_equilibrium_with_kwant_files/libs/quarto-html/popper.min.js"></script>
<script src="nanostructures_out_of_equilibrium_with_kwant_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="nanostructures_out_of_equilibrium_with_kwant_files/libs/quarto-html/anchor.min.js"></script>
<link href="nanostructures_out_of_equilibrium_with_kwant_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="nanostructures_out_of_equilibrium_with_kwant_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="nanostructures_out_of_equilibrium_with_kwant_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="nanostructures_out_of_equilibrium_with_kwant_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="nanostructures_out_of_equilibrium_with_kwant_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Nanostructures out of equilibrium with KWANT</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="marko-petrović-university-of-delaware" class="level3">
<h3 class="anchored" data-anchor-id="marko-petrović-university-of-delaware">© Marko Petrović, University of Delaware</h3>
<p><a href="https://wiki.physics.udel.edu/phys824">PHYS824: Nanophysics &amp; Nanotechnology</a></p>
</section>
<section id="what-is-covered-in-this-notebook" class="level2">
<h2 class="anchored" data-anchor-id="what-is-covered-in-this-notebook">What is covered in this notebook</h2>
<ul>
<li>Two terminal Landauer-Buttiker formula
<ul>
<li>Square lattice (spinless) with temperature smearing.</li>
<li>Square lattice with Rashba interaction.</li>
<li>Square lattice with disorder and transmission matrix eigenvalues.</li>
<li>Ring with AB oscillations.</li>
</ul></li>
<li>Adding custom hopping in KWANT</li>
<li>Buttiker dephasing.</li>
<li>Spin Hall effect in four terminal device.</li>
<li>Topological Hall effect in four terminal device.</li>
</ul>
</section>
<section id="conductance-in-a-two-terminal-square-ribbon" class="level1">
<h1>1.1 Conductance in a two-terminal square ribbon</h1>
<p>First, we need to create a two-terminal ribbon on a square lattice.</p>
<div class="cell" data-execution_count="594">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> kwant</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lead_along_x(pos):</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> pos</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="fl">3.5</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(y) <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">*</span>width </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> system_shape(pos):</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> pos</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="fl">3.5</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="fl">20.0</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(x) <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">*</span>length <span class="kw">and</span> <span class="bu">abs</span>(y) <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">*</span>width</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the system</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>sys <span class="op">=</span> kwant.Builder()</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>lat <span class="op">=</span> kwant.lattice.square(norbs<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>v1, v2 <span class="op">=</span> lat.prim_vecs</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> <span class="fl">1.</span>         <span class="co"># Hopping energy</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>left_direction <span class="op">=</span> kwant.TranslationalSymmetry(<span class="op">-</span>v1)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>lead_left <span class="op">=</span> kwant.Builder(left_direction)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create main scattering region</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>sys[lat.shape(system_shape, (<span class="dv">0</span>, <span class="dv">0</span>))] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>sys[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>t</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create left lead</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>lead_left[lat.shape(lead_along_x, (<span class="dv">0</span>, <span class="dv">0</span>))] <span class="op">=</span> <span class="fl">0.0</span> </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>lead_left[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>t</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>sys.attach_lead(lead_left)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>sys.attach_lead(lead_left.<span class="bu">reversed</span>())</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>sys_f <span class="op">=</span> sys.finalized()         <span class="co"># Create finalized sytem</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>kwant.plot(sys)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-2-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="transmission-and-scattering-matrix" class="level3">
<h3 class="anchored" data-anchor-id="transmission-and-scattering-matrix">1.1.1 Transmission and scattering matrix</h3>
<p>To calculate transmission in a two-terminal device, use <code>kwant.smatrix</code> object to obtain the scattering matrix at a given energy. The obtained scattering matrix object has a method called <code>transmission</code> which is used to calculate transmission between any pair of the attached leads.</p>
<div class="cell" data-execution_count="603">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>t10 <span class="op">=</span> []       <span class="co"># Transmission from lead 0 to lead 1</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>energies <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">200</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> energy <span class="kw">in</span> energies:</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    smatrix <span class="op">=</span> kwant.smatrix(sys_f, energy)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Here, we calculate the transmission </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># from the first lead (left lead) </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to the second lead (right lead). </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Indexing starts at zero, and it</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># depends on the order in which </span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the leads were attached. Lead</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># which is attached first will get </span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the index zero, the one that is</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># attached second will get the index</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># one etc.</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The transmission function is T(E) = Tr[t*t^\dagger]</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Transmission from the lead 0 to lead 1</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    t10.append(smatrix.transmission(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>t10 <span class="op">=</span> np.array(t10)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>plt.plot(energies, t10, color<span class="op">=</span><span class="st">'C0'</span>)<span class="op">;</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fermi Energy (eV)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Zero-temperature conductance in a two-terminal device'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'G ($\frac{2e^2}</span><span class="sc">{h}</span><span class="vs">$)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-3-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="temperature-smearing-of-the-conductance" class="level3">
<h3 class="anchored" data-anchor-id="temperature-smearing-of-the-conductance">1.1.2 Temperature smearing of the conductance</h3>
<p>Temperature smearing is performed by convolution <span class="math display">\[ G(T, E_F) = \frac{2e^2}{h}\int_{-\infty}^{+\infty} T(E)
\left(-\frac{\partial f(E)}{\partial E}\right) dE \]</span> with a derivative of the Fermi-Dirac function <span class="math display">\[ -\frac{\partial f(E)}{\partial E} =  
     \frac{1}{4k_BT}{\rm sech}^2\left(\frac{E-E_{\rm F}}{2k_BT}\right)\]</span></p>
<div class="cell" data-execution_count="604">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>KB <span class="op">=</span> <span class="fl">8.617e-5</span>   <span class="co"># eV / K</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> F(energy, ef<span class="op">=</span><span class="dv">0</span>, temp<span class="op">=</span><span class="fl">300.</span>):</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> (<span class="dv">4</span> <span class="op">*</span> KB <span class="op">*</span> temp)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n <span class="op">*</span> (<span class="fl">1.0</span> <span class="op">/</span> np.cosh((energy <span class="op">-</span> ef) <span class="op">/</span> (<span class="dv">2</span><span class="op">*</span>KB<span class="op">*</span>temp)))<span class="op">**</span><span class="dv">2</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>ens <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">100</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>de <span class="op">=</span> ens[<span class="dv">1</span>] <span class="op">-</span> ens[<span class="dv">0</span>]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>plt.plot(ens, F(ens)<span class="op">*</span>de)<span class="op">;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'SUM = '</span>, (F(ens)<span class="op">*</span>de).<span class="bu">sum</span>())</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"8Kb*T ="</span>, <span class="dv">8</span><span class="op">*</span>KB<span class="op">*</span><span class="dv">300</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Energy (eV)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'$-\frac{\partial f(E)}{\partial E}$'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SUM =  0.9998857350102481
8Kb*T = 0.206808</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Next, we convolute the previously computed conductance with temperature.</p>
<div class="cell" data-execution_count="605">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute transmission close to</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># one of the steps</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>t10 <span class="op">=</span> []     </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>energies <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">300</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> energy <span class="kw">in</span> energies:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    smatrix <span class="op">=</span> kwant.smatrix(sys_f, energy)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    t10.append(smatrix.transmission(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>t10 <span class="op">=</span> np.array(t10)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>t_conv <span class="op">=</span> []</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>temperature <span class="op">=</span> <span class="fl">300.</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>de <span class="op">=</span> energies[<span class="dv">1</span>] <span class="op">-</span> energies[<span class="dv">0</span>]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ef <span class="kw">in</span> energies:</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> F(energies, ef<span class="op">=</span>ef, temp<span class="op">=</span>temperature)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    t_conv.append((df<span class="op">*</span>t10<span class="op">*</span>de).<span class="bu">sum</span>())</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>t_conv <span class="op">=</span> np.array(t_conv)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">150</span>, figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))   <span class="co"># Set figure size in inches</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>plt.plot(energies, t10, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">1.0</span>, label<span class="op">=</span><span class="vs">r'T = 0 K'</span>)<span class="op">;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>plt.plot(energies, t_conv, color<span class="op">=</span><span class="st">'C3'</span>, lw<span class="op">=</span><span class="fl">1.0</span>, label<span class="op">=</span><span class="vs">r'T = 300 K'</span>)<span class="op">;</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="dv">4</span>, <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fermi Energy (eV)'</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'G $(\frac{2e^2}</span><span class="sc">{h}</span><span class="vs">$)'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="rashba-spin-orbit-coupling" class="level1">
<h1>1.2 Rashba spin-orbit coupling</h1>
<p>The Rashba Hamiltonian on the square tight-binding lattice of sites <span class="math inline">\({\bf m} = (m_x, m_y)\)</span> is given by</p>
<p><span class="math display">\[
\hat{H}=\sum_{{\bf m}\sigma} \varepsilon_{\bf m}
|{\bf m}\sigma\rangle\langle{\bf m}\sigma|+
\sum_{{\bf mm'}
\sigma\sigma'}
t_{\bf mm'}^{\sigma\sigma'}
|{{\bf m}\sigma}\rangle
\langle{{\bf m'}\sigma'}|.
\]</span></p>
<p>Its hopping parameters are non-trivial <span class="math inline">\(2 \times 2\)</span> Hermitian matrices <span class="math inline">\({\bf t}_{\bf m'm}=({\bf t}_{\bf mm'})^\dagger\)</span> in the spin space</p>
<p><span class="math display">\[
{\bf t}_{\bf mm'}=\left\{
\begin{array}{cc}
-t{\bf I}_{\rm 2}-it_{\rm SO}\hat{\sigma}_y &amp;
({\bf m}={\bf m}'+{\bf e}_x)\\
-t{\bf I}_{\rm 2}+it_{\rm SO}\hat{\sigma}_x &amp;  ({\bf m}={\bf m}'+{\bf e}_y)
\end{array}\right.,
\]</span></p>
<p>First, we need to define unit matrix <span class="math inline">\(I_2\)</span> and Pauli matrices</p>
$I_2 = (
<span class="math display">\[\begin{matrix} 1 &amp; 0 \\ 0 &amp; 1\end{matrix}\]</span>
) $, $_x = (
<span class="math display">\[\begin{matrix} 0 &amp; 1 \\ 1 &amp; 0\end{matrix}\]</span>
) $, $_y = (
<span class="math display">\[\begin{matrix} 0 &amp; -i \\ i &amp; 0\end{matrix}\]</span>
) $, $_z = (
<span class="math display">\[\begin{matrix} 1 &amp; 0 \\ 0 &amp; -1\end{matrix}\]</span>
<p>) $</p>
<div class="cell" data-execution_count="606">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>unit <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>]])</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sigma_x <span class="op">=</span> np.array([[<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">0</span>]])</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>sigma_y <span class="op">=</span> np.array([[<span class="dv">0</span>, <span class="op">-</span><span class="ot">1j</span>], [<span class="ot">1j</span>, <span class="dv">0</span>]])</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>sigma_z <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="578">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_rashba_system(rsoc<span class="op">=</span><span class="fl">1.0</span>, t<span class="op">=</span><span class="fl">1.0</span>, width<span class="op">=</span><span class="fl">3.</span>, length<span class="op">=</span><span class="fl">4.</span>):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> lead_along_x(pos):</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (y <span class="op">&gt;</span> <span class="dv">0</span>) <span class="kw">and</span> (y <span class="op">&lt;=</span> width) </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> system_shape(pos):</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        in_x <span class="op">=</span> (x <span class="op">&gt;</span> <span class="dv">0</span>) <span class="kw">and</span> (x <span class="op">&lt;=</span> length)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        in_y <span class="op">=</span> (y <span class="op">&gt;</span> <span class="dv">0</span>) <span class="kw">and</span> (y <span class="op">&lt;=</span> width)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> in_x <span class="kw">and</span> in_y</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rashba(site1, site2):</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        x1, y1 <span class="op">=</span> site1.pos</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        x2, y2 <span class="op">=</span> site2.pos</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if two sites are connected</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># with hopping along x-direction</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># (Then they have the same y-coordinate)</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        hopping_along_x <span class="op">=</span> <span class="bu">abs</span>(y2 <span class="op">-</span> y1) <span class="op">&lt;</span> <span class="fl">1.e-6</span>   </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> hopping_along_x: </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            hopping <span class="op">=</span> <span class="op">-</span>t<span class="op">*</span>unit <span class="op">-</span> <span class="ot">1j</span><span class="op">*</span>rsoc<span class="op">*</span>sigma_y</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:    <span class="co"># Set hopping along y</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>            hopping <span class="op">=</span> <span class="op">-</span>t<span class="op">*</span>unit <span class="op">+</span> <span class="ot">1j</span><span class="op">*</span>rsoc<span class="op">*</span>sigma_x</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Notice that here hoppings are not scalars</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># but [2 x 2] matrices</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> hopping</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build the system</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> kwant.Builder()</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Notice that there are now two orbitals per site</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> kwant.lattice.square(norbs<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    v1, v2 <span class="op">=</span> lat.prim_vecs</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    left_direction <span class="op">=</span> kwant.TranslationalSymmetry(<span class="op">-</span>v1)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    lead_left <span class="op">=</span> kwant.Builder(left_direction)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create main scattering region</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    sys[lat.shape(system_shape, (<span class="dv">1</span>, <span class="dv">1</span>))] <span class="op">=</span> <span class="dv">0</span><span class="op">*</span>unit</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    sys[lat.neighbors()] <span class="op">=</span> rashba</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create left lead</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    lead_left[lat.shape(lead_along_x, (<span class="dv">1</span>, <span class="dv">1</span>))] <span class="op">=</span> <span class="dv">0</span><span class="op">*</span>unit </span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    lead_left[lat.neighbors()] <span class="op">=</span> rashba</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    sys.attach_lead(lead_left)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    sys.attach_lead(lead_left.<span class="bu">reversed</span>())</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    sys_f <span class="op">=</span> sys.finalized()         <span class="co"># Create finalized sytem</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    lead_f <span class="op">=</span> lead_left.finalized()  <span class="co"># Create finalized lead</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sys_f, lead_f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="607">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sys, lead <span class="op">=</span> make_rashba_system(width<span class="op">=</span><span class="dv">2</span>, length<span class="op">=</span><span class="dv">3</span>, rsoc<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>kwant.plot(sys)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Next, compute dispersion and transmission in this ribbon</p>
<div class="cell" data-execution_count="610">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>t10 <span class="op">=</span> []       <span class="co"># Transmission from lead 0 to lead 1</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>energies <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">200</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> energy <span class="kw">in</span> energies:</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    smatrix <span class="op">=</span> kwant.smatrix(sys, energy)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    t10.append(smatrix.transmission(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">100</span>, figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>kwant.plotter.bands(lead)<span class="op">;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>t10 <span class="op">=</span> np.array(t10)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>plt.plot(energies, t10, color<span class="op">=</span><span class="st">'C0'</span>)<span class="op">;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fermi Energy (eV)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Zero-temperature conductance in a two-terminal Rashba device'</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'G ($\frac{e^2}</span><span class="sc">{h}</span><span class="vs">$)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 300x300 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-9-output-3.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="introducing-anderson-disorder" class="level1">
<h1>1.3 Introducing Anderson disorder</h1>
<p>The Anderson Hamiltonian on the square tight-binding lattice of sites <span class="math inline">\({\bf m} = (m_x, m_y)\)</span> is given by</p>
<p><span class="math display">\[
\hat{H}=\sum_{{\bf m}} \varepsilon_{\bf m}
|{\bf m}\rangle\langle{\bf m}|+
\sum_{{\bf mm'}}
t_{\bf mm'}
|{{\bf m}}\rangle
\langle{{\bf m'}}|.
\]</span></p>
<p>The on-site potential is a uniform random variable <span class="math inline">\(\varepsilon_{\bf m} \in [-W/2,W/2]\)</span> modeling short range isotropic scattering.</p>
<div class="cell" data-execution_count="548">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_system(w<span class="op">=</span><span class="dv">5</span>, t<span class="op">=-</span><span class="fl">1.0</span>, width<span class="op">=</span><span class="dv">3</span>, length<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> lead_along_x(pos):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (y <span class="op">&gt;</span> <span class="dv">0</span>) <span class="kw">and</span> (y <span class="op">&lt;=</span> width) </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> system_shape(pos):</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        in_x <span class="op">=</span> (x <span class="op">&gt;</span> <span class="dv">0</span>) <span class="kw">and</span> (x <span class="op">&lt;=</span> length)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        in_y <span class="op">=</span> (y <span class="op">&gt;</span> <span class="dv">0</span>) <span class="kw">and</span> (y <span class="op">&lt;=</span> width)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> in_x <span class="kw">and</span> in_y</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> random_potential(site):</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        pot <span class="op">=</span> np.random.random()</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        pot_w <span class="op">=</span> w<span class="op">*</span>(<span class="dv">2</span><span class="op">*</span>pot <span class="op">-</span> <span class="dv">1</span>)<span class="op">/</span><span class="fl">2.</span> </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pot_w</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> kwant.Builder()</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> kwant.lattice.square(norbs<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    v1, v2 <span class="op">=</span> lat.prim_vecs</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    left_direction <span class="op">=</span> kwant.TranslationalSymmetry(<span class="op">-</span>v1)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    lead_left <span class="op">=</span> kwant.Builder(left_direction)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create main scattering region</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    sys[lat.shape(system_shape, (<span class="dv">1</span>, <span class="dv">1</span>))] <span class="op">=</span> random_potential</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    sys[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>t</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create left lead (no potential disorder)</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    lead_left[lat.shape(lead_along_x, (<span class="dv">1</span>, <span class="dv">1</span>))] <span class="op">=</span> <span class="fl">0.</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    lead_left[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>t</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    sys.attach_lead(lead_left)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    sys.attach_lead(lead_left.<span class="bu">reversed</span>())</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    sys_f <span class="op">=</span> sys.finalized()         <span class="co"># Create finalized sytem</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    lead_f <span class="op">=</span> lead_left.finalized()  <span class="co"># Create finalized lead</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sys_f, lead_f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="plot-onsite-potential" class="level3">
<h3 class="anchored" data-anchor-id="plot-onsite-potential">1.3.2 Plot onsite potential</h3>
<div class="cell" data-execution_count="612">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sys, lead <span class="op">=</span> make_system(w<span class="op">=</span><span class="fl">0.5</span>, length<span class="op">=</span><span class="dv">20</span>, width<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">5</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> sys.hamiltonian_submatrix()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> np.diag(h)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>kwant.plotter.<span class="bu">map</span>(sys, v.real)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="compute-conductance-using-transmission-matrix" class="level3">
<h3 class="anchored" data-anchor-id="compute-conductance-using-transmission-matrix">1.3.3 Compute conductance using transmission matrix</h3>
<div class="cell" data-execution_count="613">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>t10 <span class="op">=</span> []       <span class="co"># Transmission from lead 0 to lead 1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>energies <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">100</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> energy <span class="kw">in</span> energies:</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    smatrix <span class="op">=</span> kwant.smatrix(sys, energy)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note, you need to set the seed</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># each time you call a solver</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    np.random.seed(<span class="dv">2</span>) </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    tmat <span class="op">=</span> smatrix.submatrix(<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    tt <span class="op">=</span> np.dot(tmat, tmat.conj())</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    t10.append(np.trace(tt))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">100</span>, figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>t10 <span class="op">=</span> np.array(t10)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>plt.plot(energies, t10, color<span class="op">=</span><span class="st">'C0'</span>)<span class="op">;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fermi Energy (eV)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Zero-temperature conductance in a two-terminal device'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'G ($\frac{2e^2}</span><span class="sc">{h}</span><span class="vs">$)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="eigenvalues-of-the-transmission-matrix" class="level3">
<h3 class="anchored" data-anchor-id="eigenvalues-of-the-transmission-matrix">1.3.4 Eigenvalues of the transmission matrix</h3>
<div class="cell" data-execution_count="614">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>seeds <span class="op">=</span> np.arange(<span class="dv">100</span>)  <span class="co"># Do the averaging over 10 distributions</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>t_evals <span class="op">=</span> []</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> seed <span class="kw">in</span> seeds:</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    smatrix <span class="op">=</span> kwant.smatrix(sys, <span class="fl">0.</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    np.random.seed(seed) </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    tmat <span class="op">=</span> smatrix.submatrix(<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    tt <span class="op">=</span> np.dot(tmat, tmat.conj())</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    evals <span class="op">=</span> np.linalg.eigvals(tt)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    t_evals <span class="op">=</span> t_evals <span class="op">+</span> <span class="bu">list</span>(evals)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">100</span>, figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>plt.hist(t_evals, bins<span class="op">=</span>bins)<span class="op">;</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Transmission Eigenvalue'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'P(T)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="introducing-vacancy-disorder" class="level1">
<h1>1.4 Introducing vacancy disorder</h1>
<p>In a similar way in which we add sites to the system, we use the delete (<code>del</code>) command to remove sites from the system. Notice that sites can only be removed from a system which is not finalized.</p>
<div class="cell" data-execution_count="615">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_disordered_system(seed<span class="op">=</span><span class="dv">0</span>, nvac<span class="op">=</span><span class="dv">5</span>, t<span class="op">=-</span><span class="fl">1.0</span>, width<span class="op">=</span><span class="dv">3</span>, length<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">    seed : integer</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">        Determines how vacancies are sampled. Each</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">        integer will produce a unique distribution</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">        of vacancies</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">    nvac : integer</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of vacancies in the system</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> lead_along_x(pos):</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (y <span class="op">&gt;</span> <span class="dv">0</span>) <span class="kw">and</span> (y <span class="op">&lt;=</span> width) </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> system_shape(pos):</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        in_x <span class="op">=</span> (x <span class="op">&gt;</span> <span class="dv">0</span>) <span class="kw">and</span> (x <span class="op">&lt;=</span> length)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        in_y <span class="op">=</span> (y <span class="op">&gt;</span> <span class="dv">0</span>) <span class="kw">and</span> (y <span class="op">&lt;=</span> width)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> in_x <span class="kw">and</span> in_y</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> kwant.Builder()</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> kwant.lattice.square(norbs<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    v1, v2 <span class="op">=</span> lat.prim_vecs</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    left_direction <span class="op">=</span> kwant.TranslationalSymmetry(<span class="op">-</span>v1)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    lead_left <span class="op">=</span> kwant.Builder(left_direction)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create main scattering region</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    sys[lat.shape(system_shape, (<span class="dv">1</span>, <span class="dv">1</span>))] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    sys[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>t</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create left lead</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    lead_left[lat.shape(lead_along_x, (<span class="dv">1</span>, <span class="dv">1</span>))] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    lead_left[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>t</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    sys.attach_lead(lead_left)</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    sys.attach_lead(lead_left.<span class="bu">reversed</span>())</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    np.random.seed(seed)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    nv <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>    lengths <span class="op">=</span> np.arange(<span class="dv">1</span>, length<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    widths <span class="op">=</span> np.arange(<span class="dv">1</span>, width<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    nv <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> nv <span class="op">&lt;</span> nvac:</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> np.random.randint(length)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> np.random.randint(width)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>            <span class="kw">del</span> sys[lat(i, j)]</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>            nv <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    sys_f <span class="op">=</span> sys.finalized()         <span class="co"># Create finalized sytem</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    lead_f <span class="op">=</span> lead_left.finalized()  <span class="co"># Create finalized lead</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sys_f, lead_f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="616">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>sys, lead <span class="op">=</span> make_disordered_system(seed<span class="op">=</span><span class="dv">2</span>, length<span class="op">=</span><span class="dv">10</span>, width<span class="op">=</span><span class="dv">10</span>, nvac<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>kwant.plot(sys)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="aharonov-bohm-oscillations" class="level1">
<h1>1.5 Aharonov-Bohm oscillations</h1>
<div class="cell" data-execution_count="620">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_ring(t<span class="op">=</span><span class="fl">1.0</span>, out_radius<span class="op">=</span><span class="dv">10</span>, in_radius<span class="op">=</span><span class="dv">5</span>, width<span class="op">=</span><span class="dv">4</span>, length<span class="op">=</span><span class="fl">5.</span>):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> lead_along_x(pos):</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">abs</span>(y) <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">*</span>width</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> system_shape(pos):</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> np.sqrt(x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        in_outer <span class="op">=</span> r <span class="op">&lt;</span> out_radius </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        in_inner <span class="op">=</span> r <span class="op">&lt;</span> in_radius</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        in_ring <span class="op">=</span> in_outer <span class="kw">and</span> <span class="kw">not</span> in_inner</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> in_ring</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> bfield(site1, site2, flux):</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        x1, y1 <span class="op">=</span> site1.pos</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        x2, y2 <span class="op">=</span> site2.pos</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x1 <span class="op">==</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> y1 <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">and</span> y1 <span class="op">==</span> y2: </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>            hop <span class="op">=</span>  <span class="op">-</span>t<span class="op">*</span>np.exp(<span class="op">-</span><span class="ot">1j</span><span class="op">*</span>flux)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>            hop <span class="op">=</span>  <span class="op">-</span>t</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> hop</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> kwant.Builder()</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> kwant.lattice.square(norbs<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    v1, v2 <span class="op">=</span> lat.prim_vecs</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    left_direction <span class="op">=</span> kwant.TranslationalSymmetry(<span class="op">-</span>v1)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    lead_left <span class="op">=</span> kwant.Builder(left_direction)</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    r_cent <span class="op">=</span> <span class="fl">0.5</span><span class="op">*</span>(in_radius <span class="op">+</span> out_radius)</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    sys[lat.shape(system_shape, (r_cent, <span class="dv">0</span>))] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    sys[lat.neighbors()] <span class="op">=</span> bfield  </span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    lead_left[lat.shape(lead_along_x, (<span class="dv">0</span>, <span class="dv">0</span>))] <span class="op">=</span> <span class="fl">0.</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>    lead_left[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>t</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    sys.attach_lead(lead_left)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    sys.attach_lead(lead_left.<span class="bu">reversed</span>())</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    sys_f <span class="op">=</span> sys.finalized()         <span class="co"># Create finalized sytem</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    lead_f <span class="op">=</span> lead_left.finalized()  <span class="co"># Create finalized lead</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sys_f, lead_f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="618">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ring_sys, lead <span class="op">=</span> make_ring(in_radius<span class="op">=</span><span class="dv">5</span>, out_radius<span class="op">=</span><span class="dv">13</span>, width<span class="op">=</span><span class="dv">10</span>, length<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>kwant.plot(ring_sys)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="transmission-at-zero-magnetic-field" class="level3">
<h3 class="anchored" data-anchor-id="transmission-at-zero-magnetic-field">1.5.1 Transmission at zero magnetic field</h3>
<div class="cell" data-execution_count="621">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>t10 <span class="op">=</span> []       <span class="co"># Transmission from lead 0 to lead 1</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>energies <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">100</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> energy <span class="kw">in</span> energies:</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    smatrix <span class="op">=</span> kwant.smatrix(ring_sys, energy, params<span class="op">=</span>{<span class="st">'flux'</span>:<span class="fl">0.</span>})</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    t10.append(smatrix.transmission(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">100</span>, figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>plt.plot(energies, t10, color<span class="op">=</span><span class="st">'C0'</span>)<span class="op">;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Energy (eV)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Conductance in a two-terminal device'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'G ($\frac{2e^2}</span><span class="sc">{h}</span><span class="vs">$)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="aharonov-bohm-oscillations-1" class="level3">
<h3 class="anchored" data-anchor-id="aharonov-bohm-oscillations-1">1.5.2 Aharonov-Bohm oscillations</h3>
<div class="cell" data-execution_count="460">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>t10 <span class="op">=</span> []       <span class="co"># Transmission from lead 0 to lead 1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fluxes <span class="op">=</span> np.linspace(<span class="fl">0.1</span>, <span class="fl">30.</span>, <span class="dv">100</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> flux <span class="kw">in</span> fluxes:</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    smatrix <span class="op">=</span> kwant.smatrix(ring_sys, <span class="fl">3.85</span>, params<span class="op">=</span>{<span class="st">'flux'</span>: flux})</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    t10.append(smatrix.transmission(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">100</span>, figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>plt.plot(fluxes<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), t10, color<span class="op">=</span><span class="st">'C0'</span>)<span class="op">;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Magnetic flux'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'G ($\frac{2e^2}</span><span class="sc">{h}</span><span class="vs">$)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="büttiker-dephasing" class="level1">
<h1>2. Büttiker dephasing</h1>
<p>Introducing an additional third lead in a two-terminal device will lead to Büttiker dephasing, where the dephased transmission <span class="math inline">\(\tilde{T}_{21}\)</span> between leads 1 and 2 is given by</p>
<p><span class="math display">\[ \tilde{T}_{21}(E) = T_{\rm coherent}(E) + T_{\rm incoherent}(E) =
T_{21}(E) + \frac{T_{23}(E)T_{31}(E)}{T_{31}(E) + T_{23}(E)}
\]</span></p>
<p>First, we will modify our <code>make_ring</code> function, so that the system now has three leads. Also, we will add an option to switch from ring into a rectangle</p>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_buttiker_system(t<span class="op">=</span><span class="fl">1.0</span>, out_radius<span class="op">=</span><span class="dv">10</span>, in_radius<span class="op">=</span><span class="dv">5</span>, width<span class="op">=</span><span class="dv">4</span>, length<span class="op">=</span><span class="fl">20.</span>,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                         lead_pos<span class="op">=</span><span class="dv">0</span>, make_ring<span class="op">=</span><span class="va">True</span>, attach_probe<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                         pot<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> lead_along_x(pos):</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">abs</span>(y) <span class="op">&lt;=</span> <span class="fl">0.5</span><span class="op">*</span>width</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> lead_along_y(pos):</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">abs</span>(x<span class="op">-</span>lead_pos) <span class="op">&lt;=</span> <span class="fl">0.5</span><span class="op">*</span>width</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ring_shape(pos):</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> np.sqrt(x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        in_outer <span class="op">=</span> r <span class="op">&lt;</span> out_radius </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        in_inner <span class="op">=</span> r <span class="op">&lt;</span> in_radius</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        in_ring <span class="op">=</span> in_outer <span class="kw">and</span> <span class="kw">not</span> in_inner</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> in_ring</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> pot_function(site):</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Add potential close to the left lead"""</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> site.pos</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> make_ring:</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (x <span class="op">&lt;</span> <span class="op">-</span>out_radius <span class="op">+</span> <span class="dv">3</span>):</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                V <span class="op">=</span> pot</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>                V <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (x <span class="op">&lt;</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>length <span class="op">+</span> <span class="dv">3</span>):</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>                V <span class="op">=</span> pot</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>                V <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> V</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rectangle(pos):</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>        in_x <span class="op">=</span> <span class="bu">abs</span>(x) <span class="op">&lt;=</span> <span class="fl">0.5</span><span class="op">*</span>length</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>        in_y <span class="op">=</span> <span class="bu">abs</span>(y) <span class="op">&lt;=</span> <span class="fl">0.5</span><span class="op">*</span>width</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> in_x <span class="kw">and</span> in_y</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> kwant.Builder()</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> kwant.lattice.square(norbs<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>    v1, v2 <span class="op">=</span> lat.prim_vecs</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    left_direction <span class="op">=</span> kwant.TranslationalSymmetry(<span class="op">-</span>v1)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    left_lead <span class="op">=</span> kwant.Builder(left_direction)</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>    down_direction <span class="op">=</span> kwant.TranslationalSymmetry(<span class="op">-</span>v2)</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    down_lead <span class="op">=</span> kwant.Builder(down_direction)</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>    r_cent <span class="op">=</span> <span class="fl">0.5</span><span class="op">*</span>(in_radius <span class="op">+</span> out_radius)</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> make_ring:</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>        sys[lat.shape(ring_shape, (r_cent, <span class="dv">0</span>))] <span class="op">=</span> pot_function</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">abs</span>(lead_pos) <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">*</span>(length<span class="op">-</span>width):</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Bad lead_pos parameter. Please set it within'</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>                             <span class="st">'the (-length/2+width/2, lenght/2-width/2) range'</span>)</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>        sys[lat.shape(rectangle, (<span class="dv">0</span>, <span class="dv">0</span>))] <span class="op">=</span> pot_function</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>    sys[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>t  </span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>    left_lead[lat.shape(lead_along_x, (<span class="dv">0</span>, <span class="dv">0</span>))] <span class="op">=</span> <span class="fl">0.</span></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>    left_lead[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>t</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>    down_lead[lat.shape(lead_along_y, (lead_pos, <span class="dv">0</span>))] <span class="op">=</span> <span class="fl">0.</span></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>    down_lead[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>t</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pay attention to the order in which the leads are</span></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># attached.</span></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>    sys.attach_lead(left_lead)</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>    sys.attach_lead(left_lead.<span class="bu">reversed</span>())</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> attach_probe:</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>        sys.attach_lead(down_lead)    </span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>    sys_f <span class="op">=</span> sys.finalized()         <span class="co"># Create finalized sytem</span></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>    lead_f <span class="op">=</span> left_lead.finalized()  <span class="co"># Create finalized lead</span></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sys_f, lead_f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="dephasing-transmission-as-a-function-of-energy" class="level3">
<h3 class="anchored" data-anchor-id="dephasing-transmission-as-a-function-of-energy">2.1 Dephasing transmission as a function of energy</h3>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the system with three leads</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>sys_3lead, lead <span class="op">=</span> make_buttiker_system(out_radius<span class="op">=</span><span class="dv">10</span>, in_radius<span class="op">=</span><span class="dv">5</span>, length<span class="op">=</span><span class="fl">20.</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                                      width<span class="op">=</span><span class="dv">2</span>, lead_pos<span class="op">=</span><span class="dv">0</span>, make_ring<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make identical system, but only with two leads</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>sys_2lead, lead <span class="op">=</span> make_buttiker_system(out_radius<span class="op">=</span><span class="dv">10</span>, in_radius<span class="op">=</span><span class="dv">5</span>, length<span class="op">=</span><span class="fl">20.</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                                       width<span class="op">=</span><span class="dv">2</span>, lead_pos<span class="op">=</span><span class="dv">0</span>, make_ring<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                                       attach_probe<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>kwant.plot(sys_3lead)<span class="op">;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>energies <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">100</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>t_3lead <span class="op">=</span> []</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>t_2lead <span class="op">=</span> []</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> e <span class="kw">in</span> energies:</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    smatrix_3lead <span class="op">=</span> kwant.smatrix(sys_3lead, e)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    smatrix_2lead <span class="op">=</span> kwant.smatrix(sys_2lead, e)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    t21 <span class="op">=</span> smatrix_3lead.transmission(<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    t31 <span class="op">=</span> smatrix_3lead.transmission(<span class="dv">2</span>, <span class="dv">0</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    t23 <span class="op">=</span> smatrix_3lead.transmission(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    t_3lead.append(t21 <span class="op">+</span> (t23<span class="op">*</span>t31)<span class="op">/</span>(t23<span class="op">+</span>t31))</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    t_2lead.append(smatrix_2lead.transmission(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">140</span>, figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>plt.plot(energies, t_2lead, color<span class="op">=</span><span class="st">'gray'</span>, label<span class="op">=</span><span class="st">'no dephasing'</span>)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>plt.plot(energies, t_3lead, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'dephased'</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fermi energy (t)'</span>)<span class="op">;</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'$</span><span class="ch">\\</span><span class="st">tilde</span><span class="sc">{T}</span><span class="st">_</span><span class="sc">{21}</span><span class="st">$ '</span>)<span class="op">;</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-21-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="dephasing-transmission-as-a-function-of-lead-position" class="level3">
<h3 class="anchored" data-anchor-id="dephasing-transmission-as-a-function-of-lead-position">2.2 Dephasing transmission as a function of lead position</h3>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> np.arange(<span class="op">-</span><span class="dv">30</span>, <span class="dv">30</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>t_3lead <span class="op">=</span> []</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pos <span class="kw">in</span> positions:</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    sys_3lead, lead <span class="op">=</span> make_buttiker_system(length<span class="op">=</span><span class="fl">62.</span>, pot<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                                           width<span class="op">=</span><span class="dv">2</span>, lead_pos<span class="op">=</span>pos, make_ring<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    smatrix_3lead <span class="op">=</span> kwant.smatrix(sys_3lead, <span class="fl">0.</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    t21 <span class="op">=</span> smatrix_3lead.transmission(<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    t31 <span class="op">=</span> smatrix_3lead.transmission(<span class="dv">2</span>, <span class="dv">0</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    t23 <span class="op">=</span> smatrix_3lead.transmission(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    t_3lead.append(t21 <span class="op">+</span> (t23<span class="op">*</span>t31)<span class="op">/</span>(t23<span class="op">+</span>t31))</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">140</span>, figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>plt.plot(positions, t_3lead, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'dephased'</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Lead position'</span>)<span class="op">;</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'$</span><span class="ch">\\</span><span class="st">tilde</span><span class="sc">{T}</span><span class="st">_</span><span class="sc">{21}</span><span class="st">$ '</span>)<span class="op">;</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="spin-hall-effect-in-a-four-terminal-device" class="level1">
<h1>3. Spin Hall effect in a four-terminal device</h1>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> sqrt</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools <span class="im">as</span> it</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tinyarray <span class="im">as</span> ta</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> kwant</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> S, Eq, solve, Symbol</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Honeycomb(kwant.lattice.Polyatomic):</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Honeycomb lattice with methods for dealing with hexagons"""</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name<span class="op">=</span><span class="st">''</span>):</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        prim_vecs <span class="op">=</span> [[<span class="fl">0.5</span>, sqrt(<span class="dv">3</span>)<span class="op">/</span><span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">0</span>]]  <span class="co"># Bravais lattice vectors</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># offset the lattice so that it is symmetric around x and y axes</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        basis_vecs <span class="op">=</span> [[<span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="dv">1</span><span class="op">/</span>sqrt(<span class="dv">12</span>)], [<span class="op">-</span><span class="fl">0.5</span>, <span class="dv">1</span><span class="op">/</span>sqrt(<span class="dv">12</span>)]]</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(Honeycomb, <span class="va">self</span>).<span class="fu">__init__</span>(prim_vecs, basis_vecs, name)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.a, <span class="va">self</span>.b <span class="op">=</span> <span class="va">self</span>.sublattices</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> hexagon(<span class="va">self</span>, tag):</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Get sites belonging to hexagon with the given tag.</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co">            Returns sites in counter-clockwise order starting</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="co">            from the lower-left site.</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>        tag <span class="op">=</span> ta.array(tag)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">#         a-sites b-sites</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>        deltas <span class="op">=</span> [(<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span>, <span class="dv">0</span>), (<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">0</span>, <span class="dv">1</span>), (<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)]</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>        lats <span class="op">=</span> it.cycle(<span class="va">self</span>.sublattices)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (lat(<span class="op">*</span>(tag <span class="op">+</span> delta)) <span class="cf">for</span> lat, delta <span class="kw">in</span> <span class="bu">zip</span>(lats, deltas))</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> hexagon_neighbors(<span class="va">self</span>, tag, n<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Get n'th nearest neighbor hoppings within the hexagon with</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="co">            the given tag.</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>        hex_sites <span class="op">=</span> <span class="bu">list</span>(<span class="va">self</span>.hexagon(tag))</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ((hex_sites[(i<span class="op">+</span>n)<span class="op">%</span><span class="dv">6</span>], hex_sites[i<span class="op">%</span><span class="dv">6</span>]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>))</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> random_placement(builder, lattice, density):</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Randomly selects hexagon tags where adatoms can be placed.</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="co">        This avoids the edge case where adatoms would otherwise</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a><span class="co">        be placed on incomplete hexagons at the system boundaries.</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="dv">0</span> <span class="op">&lt;=</span> density <span class="op">&lt;=</span> <span class="dv">1</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>    system_sites <span class="op">=</span> builder.sites()</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> hexagon_in_system(tag):</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">all</span>(site <span class="kw">in</span> system_sites <span class="cf">for</span> site <span class="kw">in</span> lattice.hexagon(tag))</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get set of tags for sites in system (i.e. tags from only one sublattice)</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>    system_tags <span class="op">=</span> (s.tag <span class="cf">for</span> s <span class="kw">in</span> system_sites <span class="cf">if</span> s.family <span class="op">==</span> lattice.a)</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># only allow tags which have complete hexagons in the system</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>    valid_tags <span class="op">=</span> <span class="bu">list</span>(<span class="bu">filter</span>(hexagon_in_system, system_tags))</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> <span class="bu">int</span>(density <span class="op">*</span> <span class="bu">len</span>(valid_tags))</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>    total_hexagons<span class="op">=</span><span class="bu">len</span>(valid_tags)</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>    valuef<span class="op">=</span>random.sample(valid_tags, N)</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> valuef</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cross(W, L):</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> shape(pos):</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ((<span class="op">-</span>W <span class="op">&lt;=</span> pos[<span class="dv">0</span>] <span class="op">&lt;=</span> W <span class="kw">and</span> <span class="op">-</span>L <span class="op">&lt;=</span> pos[<span class="dv">1</span>] <span class="op">&lt;=</span> L) <span class="kw">or</span>  <span class="co"># vertical</span></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>                (<span class="op">-</span>W <span class="op">&lt;=</span> pos[<span class="dv">1</span>] <span class="op">&lt;=</span> W <span class="kw">and</span> <span class="op">-</span>L <span class="op">&lt;=</span> pos[<span class="dv">0</span>] <span class="op">&lt;=</span> L))    <span class="co"># horizontal</span></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> shape</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a><span class="co">## Pauli matrices ##</span></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>sigma_0 <span class="op">=</span> ta.array([[<span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>]])  <span class="co"># identity</span></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>sigma_x <span class="op">=</span> ta.array([[<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">0</span>]])</span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>sigma_y <span class="op">=</span> ta.array([[<span class="dv">0</span>, <span class="op">-</span><span class="ot">1j</span>], [<span class="ot">1j</span>, <span class="dv">0</span>]])</span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>sigma_z <span class="op">=</span> ta.array([[<span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>]])</span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a><span class="co">## Hamiltonian value functions ##</span></span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> onsite_potential(site, params):</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> params[<span class="st">'ep'</span>] <span class="op">*</span> sigma_0</span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> potential_shift(site, params):</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> params[<span class="st">'mu'</span>] <span class="op">*</span> sigma_0</span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> kinetic(site_i, site_j, params):</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>params[<span class="st">'gamma'</span>] <span class="op">*</span> sigma_0</span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rashba(site_i, site_j, params):</span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>    d_ij <span class="op">=</span> site_j.pos <span class="op">-</span> site_i.pos</span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>    rashba <span class="op">=</span> <span class="ot">1j</span> <span class="op">*</span> params[<span class="st">'V_R'</span>] <span class="op">*</span> (sigma_x <span class="op">*</span> d_ij[<span class="dv">1</span>] <span class="op">-</span> sigma_y <span class="op">*</span> d_ij[<span class="dv">0</span>])</span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rashba <span class="op">+</span> kinetic(site_i, site_j, params)</span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> spin_orbit(site_i, site_j, params):</span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>    so <span class="op">=</span> (<span class="ot">1j</span><span class="op">/</span><span class="fl">3.</span>) <span class="op">*</span> params[<span class="st">'V_I'</span>] <span class="op">*</span> sigma_z</span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> so</span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>lat <span class="op">=</span> Honeycomb()</span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>pv1, pv2 <span class="op">=</span> lat.prim_vecs</span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>ysym <span class="op">=</span> kwant.TranslationalSymmetry(pv2 <span class="op">-</span> <span class="dv">2</span><span class="op">*</span>pv1)  <span class="co"># -y direction</span></span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a>xsym <span class="op">=</span> kwant.TranslationalSymmetry(<span class="op">-</span>pv2)         <span class="co"># -x direction</span></span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Adatom lattice, for visualization only</span></span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>adatom_lat <span class="op">=</span> kwant.lattice.Monatomic(lat.prim_vecs, name<span class="op">=</span><span class="st">'adatom'</span>)</span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> site_size(s):                                          </span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">0.25</span> <span class="cf">if</span> s.family <span class="kw">in</span> lat.sublattices <span class="cf">else</span> <span class="fl">0.35</span></span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> site_color(s): </span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'#000000'</span> <span class="cf">if</span> s.family <span class="kw">in</span> lat.sublattices <span class="cf">else</span> <span class="st">'#de962b'</span></span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_lead_h(W, symmetry, axis<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>)):</span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>    lead <span class="op">=</span> kwant.Builder(symmetry)</span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>    lead[lat.wire(axis, W)] <span class="op">=</span> <span class="fl">0.</span> <span class="op">*</span> sigma_0</span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>    lead[lat.neighbors(<span class="dv">1</span>)] <span class="op">=</span> kinetic</span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lead</span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_lead_v(L,W, symmetry):</span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a>    lead <span class="op">=</span> kwant.Builder(symmetry)</span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a>    lead[lat.wire(axis, W)] <span class="op">=</span> <span class="fl">0.</span> <span class="op">*</span> sigma_0</span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a>    lead[lat.neighbors(<span class="dv">1</span>)] <span class="op">=</span> kinetic</span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lead</span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_hall_cross(W, L, adatom_density<span class="op">=</span><span class="fl">0.2</span>, show_adatoms<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a>    <span class="co">## scattering region ##</span></span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> kwant.Builder()</span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a>    sys[lat.shape(cross(W, L), (<span class="dv">0</span>, <span class="dv">0</span>))] <span class="op">=</span> onsite_potential</span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a>    sys[lat.neighbors(<span class="dv">1</span>)] <span class="op">=</span> kinetic</span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a>    adatoms <span class="op">=</span> random_placement(sys, lat, adatom_density)</span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a>    sys[(lat.hexagon(a) <span class="cf">for</span> a <span class="kw">in</span> adatoms)] <span class="op">=</span> potential_shift</span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a>    sys[(lat.hexagon_neighbors(a, <span class="dv">1</span>) <span class="cf">for</span> a <span class="kw">in</span> adatoms)] <span class="op">=</span> rashba</span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a>    sys[(lat.hexagon_neighbors(a, <span class="dv">2</span>) <span class="cf">for</span> a <span class="kw">in</span> adatoms)] <span class="op">=</span> spin_orbit</span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> show_adatoms:</span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a>        <span class="co"># no hoppings are added so these won't affect the dynamics; purely cosmetic</span></span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a>        sys[(adatom_lat(<span class="op">*</span>a) <span class="cf">for</span> a <span class="kw">in</span> adatoms)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a>    <span class="co">## leads ##</span></span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a>    leads <span class="op">=</span> [create_lead_h(W, xsym)]</span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a>    leads <span class="op">+=</span> [create_lead_v(L,W, ysym)]</span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a>    leads <span class="op">+=</span> [lead.<span class="bu">reversed</span>() <span class="cf">for</span> lead <span class="kw">in</span> leads]  <span class="co"># right and bottom leads</span></span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> lead <span class="kw">in</span> leads:</span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a>        sys.attach_lead(lead)</span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sys</span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_ldos(sys, Es, params):</span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a>    fsys <span class="op">=</span> sys.finalized()</span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a>    ldos <span class="op">=</span> kwant.ldos(fsys, energy<span class="op">=</span>Es, args<span class="op">=</span>(params,))</span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a>    ldos <span class="op">=</span> ldos[::<span class="dv">2</span>] <span class="op">+</span> ldos[<span class="dv">1</span>::<span class="dv">2</span>] <span class="co"># sum spins</span></span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a>    kwant.plotter.<span class="bu">map</span>(fsys, ldos, vmax<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_conductance(sys, energies, lead_i, lead_j, params):</span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>    fsys <span class="op">=</span> sys.finalized()</span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> []</span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> energy <span class="kw">in</span> energies:</span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a>        smatrix <span class="op">=</span> kwant.greens_function(fsys, energy, args<span class="op">=</span>(params,))</span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a>        data.append(smatrix.transmission(lead_i,lead_j))</span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a>    plt.figure()</span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a>    plt.plot(energies, data)</span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"energy (t)"</span>)</span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="vs">r'Conductance ($e^2/h$)'</span>)</span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_spin_conductance(sys, energies,lead_i,lead_j, params):</span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a>    fsys <span class="op">=</span> sys.finalized()</span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> []</span>
<span id="cb24-165"><a href="#cb24-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-166"><a href="#cb24-166" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> energy <span class="kw">in</span> energies:</span>
<span id="cb24-167"><a href="#cb24-167" aria-hidden="true" tabindex="-1"></a>        smatrix <span class="op">=</span> kwant.greens_function(fsys, energy, args<span class="op">=</span>(params,))</span>
<span id="cb24-168"><a href="#cb24-168" aria-hidden="true" tabindex="-1"></a>        ttdagger <span class="op">=</span> smatrix._a_ttdagger_a_inv(lead_i, lead_j)</span>
<span id="cb24-169"><a href="#cb24-169" aria-hidden="true" tabindex="-1"></a>        sigma_z_matrix <span class="op">=</span> np.kron(np.eye(<span class="bu">int</span>(<span class="bu">len</span>(ttdagger)<span class="op">/</span><span class="dv">2</span>)),sigma_z)    </span>
<span id="cb24-170"><a href="#cb24-170" aria-hidden="true" tabindex="-1"></a>        data.append(np.trace(sigma_z_matrix.dot(ttdagger)).real)</span>
<span id="cb24-171"><a href="#cb24-171" aria-hidden="true" tabindex="-1"></a>    plt.figure()</span>
<span id="cb24-172"><a href="#cb24-172" aria-hidden="true" tabindex="-1"></a>    plt.plot(energies, data)</span>
<span id="cb24-173"><a href="#cb24-173" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"energy (t)"</span>)</span>
<span id="cb24-174"><a href="#cb24-174" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="vs">r'Spin conductance ($e^2/h$)'</span>)</span>
<span id="cb24-175"><a href="#cb24-175" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb24-176"><a href="#cb24-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-177"><a href="#cb24-177" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> solvematrix4(G,I0,I2,V1,V3):</span>
<span id="cb24-178"><a href="#cb24-178" aria-hidden="true" tabindex="-1"></a>    <span class="co"># I=GxV</span></span>
<span id="cb24-179"><a href="#cb24-179" aria-hidden="true" tabindex="-1"></a>    I1,I3,V0,V2<span class="op">=</span>S(<span class="st">'I1 I3 V0 V2'</span>.split())</span>
<span id="cb24-180"><a href="#cb24-180" aria-hidden="true" tabindex="-1"></a>    equations <span class="op">=</span> [Eq(I0, G[<span class="dv">0</span>][<span class="dv">0</span>]<span class="op">*</span>V0<span class="op">+</span>G[<span class="dv">0</span>][<span class="dv">1</span>]<span class="op">*</span>V1<span class="op">+</span>G[<span class="dv">0</span>][<span class="dv">2</span>]<span class="op">*</span>V2<span class="op">+</span>G[<span class="dv">0</span>][<span class="dv">3</span>]<span class="op">*</span>V3), <span class="op">\</span></span>
<span id="cb24-181"><a href="#cb24-181" aria-hidden="true" tabindex="-1"></a>                 Eq(I1, G[<span class="dv">1</span>][<span class="dv">0</span>]<span class="op">*</span>V0<span class="op">+</span>G[<span class="dv">1</span>][<span class="dv">1</span>]<span class="op">*</span>V1<span class="op">+</span>G[<span class="dv">1</span>][<span class="dv">2</span>]<span class="op">*</span>V2<span class="op">+</span>G[<span class="dv">1</span>][<span class="dv">3</span>]<span class="op">*</span>V3), <span class="op">\</span></span>
<span id="cb24-182"><a href="#cb24-182" aria-hidden="true" tabindex="-1"></a>                 Eq(I2, G[<span class="dv">2</span>][<span class="dv">0</span>]<span class="op">*</span>V0<span class="op">+</span>G[<span class="dv">2</span>][<span class="dv">1</span>]<span class="op">*</span>V1<span class="op">+</span>G[<span class="dv">2</span>][<span class="dv">2</span>]<span class="op">*</span>V2<span class="op">+</span>G[<span class="dv">2</span>][<span class="dv">3</span>]<span class="op">*</span>V3), <span class="op">\</span></span>
<span id="cb24-183"><a href="#cb24-183" aria-hidden="true" tabindex="-1"></a>                 Eq(I3, G[<span class="dv">3</span>][<span class="dv">0</span>]<span class="op">*</span>V0<span class="op">+</span>G[<span class="dv">3</span>][<span class="dv">1</span>]<span class="op">*</span>V1<span class="op">+</span>G[<span class="dv">3</span>][<span class="dv">2</span>]<span class="op">*</span>V2<span class="op">+</span>G[<span class="dv">3</span>][<span class="dv">3</span>]<span class="op">*</span>V3)]</span>
<span id="cb24-184"><a href="#cb24-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> solve(equations, [I1,I3,V0,V2], <span class="bu">set</span><span class="op">=</span><span class="va">True</span>, <span class="bu">dict</span><span class="op">=</span><span class="va">False</span>, rational<span class="op">=</span><span class="va">None</span>, manual<span class="op">=</span><span class="va">True</span>, minimal<span class="op">=</span><span class="va">True</span>, particular<span class="op">=</span><span class="va">True</span>, implicit<span class="op">=</span><span class="va">False</span>, quick<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-185"><a href="#cb24-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-186"><a href="#cb24-186" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_SH_angle(sys, energies, params):</span>
<span id="cb24-187"><a href="#cb24-187" aria-hidden="true" tabindex="-1"></a>    fsys <span class="op">=</span> sys.finalized()</span>
<span id="cb24-188"><a href="#cb24-188" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> []</span>
<span id="cb24-189"><a href="#cb24-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-190"><a href="#cb24-190" aria-hidden="true" tabindex="-1"></a>    I0 <span class="op">=</span> <span class="fl">0.</span></span>
<span id="cb24-191"><a href="#cb24-191" aria-hidden="true" tabindex="-1"></a>    I2 <span class="op">=</span> <span class="fl">0.</span></span>
<span id="cb24-192"><a href="#cb24-192" aria-hidden="true" tabindex="-1"></a>    V1 <span class="op">=</span> <span class="fl">1.</span></span>
<span id="cb24-193"><a href="#cb24-193" aria-hidden="true" tabindex="-1"></a>    V3 <span class="op">=</span> <span class="fl">0.</span></span>
<span id="cb24-194"><a href="#cb24-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-195"><a href="#cb24-195" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> energy <span class="kw">in</span> energies:</span>
<span id="cb24-196"><a href="#cb24-196" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\r</span><span class="st"> Energy = </span><span class="sc">%.5f</span><span class="st">"</span> <span class="op">%</span> energy, end<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb24-197"><a href="#cb24-197" aria-hidden="true" tabindex="-1"></a>        smatrix <span class="op">=</span> kwant.greens_function(fsys, energy, args<span class="op">=</span>(params,))</span>
<span id="cb24-198"><a href="#cb24-198" aria-hidden="true" tabindex="-1"></a>        G <span class="op">=</span> np.zeros((<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb24-199"><a href="#cb24-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb24-200"><a href="#cb24-200" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb24-201"><a href="#cb24-201" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb24-202"><a href="#cb24-202" aria-hidden="true" tabindex="-1"></a>                G[i,j] <span class="op">=</span> smatrix.transmission(i, j)</span>
<span id="cb24-203"><a href="#cb24-203" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">!=</span> j: a<span class="op">+=</span>G[i,j]</span>
<span id="cb24-204"><a href="#cb24-204" aria-hidden="true" tabindex="-1"></a>            G[i,i]<span class="op">=-</span>a</span>
<span id="cb24-205"><a href="#cb24-205" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> solvematrix4(G, I0, I2, V1, V3)[<span class="dv">1</span>]</span>
<span id="cb24-206"><a href="#cb24-206" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> <span class="bu">list</span>(a)</span>
<span id="cb24-207"><a href="#cb24-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-208"><a href="#cb24-208" aria-hidden="true" tabindex="-1"></a>        I1 <span class="op">=</span> result[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb24-209"><a href="#cb24-209" aria-hidden="true" tabindex="-1"></a>        I3 <span class="op">=</span> result[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb24-210"><a href="#cb24-210" aria-hidden="true" tabindex="-1"></a>        V0 <span class="op">=</span> result[<span class="dv">0</span>][<span class="dv">2</span>]</span>
<span id="cb24-211"><a href="#cb24-211" aria-hidden="true" tabindex="-1"></a>        V2 <span class="op">=</span> result[<span class="dv">0</span>][<span class="dv">3</span>]</span>
<span id="cb24-212"><a href="#cb24-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-213"><a href="#cb24-213" aria-hidden="true" tabindex="-1"></a>        Gspin <span class="op">=</span> np.zeros((<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb24-214"><a href="#cb24-214" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb24-215"><a href="#cb24-215" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb24-216"><a href="#cb24-216" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb24-217"><a href="#cb24-217" aria-hidden="true" tabindex="-1"></a>                ttdagger <span class="op">=</span> smatrix._a_ttdagger_a_inv(i, j)</span>
<span id="cb24-218"><a href="#cb24-218" aria-hidden="true" tabindex="-1"></a>                sigma_z_matrix <span class="op">=</span> np.kron(np.eye(<span class="bu">int</span>(<span class="bu">len</span>(ttdagger)<span class="op">/</span><span class="dv">2</span>)),sigma_z)    </span>
<span id="cb24-219"><a href="#cb24-219" aria-hidden="true" tabindex="-1"></a>                Gspin[i,j] <span class="op">=</span> np.trace(sigma_z_matrix.dot(ttdagger)).real</span>
<span id="cb24-220"><a href="#cb24-220" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">!=</span> j: a<span class="op">+=</span>Gspin[i,j]</span>
<span id="cb24-221"><a href="#cb24-221" aria-hidden="true" tabindex="-1"></a>            Gspin[i,i]<span class="op">=-</span>a</span>
<span id="cb24-222"><a href="#cb24-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-223"><a href="#cb24-223" aria-hidden="true" tabindex="-1"></a>        IS0 <span class="op">=</span> Gspin[<span class="dv">1</span>,<span class="dv">0</span>] <span class="op">*</span> (V1<span class="op">-</span>V0) <span class="op">+</span> Gspin[<span class="dv">2</span>,<span class="dv">0</span>]<span class="op">*</span>(V2<span class="op">-</span>V0) <span class="op">+</span> Gspin[<span class="dv">3</span>,<span class="dv">0</span>] <span class="op">*</span> (V3<span class="op">-</span>V0)</span>
<span id="cb24-224"><a href="#cb24-224" aria-hidden="true" tabindex="-1"></a>        data.append(IS0<span class="op">/</span>I1)</span>
<span id="cb24-225"><a href="#cb24-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-226"><a href="#cb24-226" aria-hidden="true" tabindex="-1"></a>    plt.figure()</span>
<span id="cb24-227"><a href="#cb24-227" aria-hidden="true" tabindex="-1"></a>    plt.plot(energies, data)</span>
<span id="cb24-228"><a href="#cb24-228" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Energy (t)"</span>)</span>
<span id="cb24-229"><a href="#cb24-229" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Spin Hall Angle"</span>)</span>
<span id="cb24-230"><a href="#cb24-230" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb24-231"><a href="#cb24-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-232"><a href="#cb24-232" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb24-233"><a href="#cb24-233" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> <span class="bu">dict</span>(gamma<span class="op">=</span><span class="fl">1.</span>, ep<span class="op">=</span><span class="dv">0</span>, mu<span class="op">=</span><span class="fl">0.1</span>, </span>
<span id="cb24-234"><a href="#cb24-234" aria-hidden="true" tabindex="-1"></a>                  V_I<span class="op">=</span><span class="fl">0.007</span>, V_R<span class="op">=</span><span class="fl">0.0165</span>)  <span class="co"># Au adatoms</span></span>
<span id="cb24-235"><a href="#cb24-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-236"><a href="#cb24-236" aria-hidden="true" tabindex="-1"></a>    W <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb24-237"><a href="#cb24-237" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb24-238"><a href="#cb24-238" aria-hidden="true" tabindex="-1"></a>    adatom_density<span class="op">=</span><span class="fl">0.01</span></span>
<span id="cb24-239"><a href="#cb24-239" aria-hidden="true" tabindex="-1"></a>    <span class="co"># adatom_density=0.15</span></span>
<span id="cb24-240"><a href="#cb24-240" aria-hidden="true" tabindex="-1"></a>    <span class="co"># W = 8</span></span>
<span id="cb24-241"><a href="#cb24-241" aria-hidden="true" tabindex="-1"></a>    <span class="co"># L = 16</span></span>
<span id="cb24-242"><a href="#cb24-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-243"><a href="#cb24-243" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> create_hall_cross(W, L, adatom_density, show_adatoms<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-244"><a href="#cb24-244" aria-hidden="true" tabindex="-1"></a>    kwant.plot(sys, site_color<span class="op">=</span>site_color, site_size<span class="op">=</span>site_size)</span>
<span id="cb24-245"><a href="#cb24-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-246"><a href="#cb24-246" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> create_hall_cross(W, L, adatom_density, show_adatoms<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-247"><a href="#cb24-247" aria-hidden="true" tabindex="-1"></a>    plot_ldos(sys, <span class="fl">1e-5</span>, params)</span>
<span id="cb24-248"><a href="#cb24-248" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-249"><a href="#cb24-249" aria-hidden="true" tabindex="-1"></a>    Es <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dv">101</span>)</span>
<span id="cb24-250"><a href="#cb24-250" aria-hidden="true" tabindex="-1"></a>    plot_spin_conductance(sys, Es, <span class="dv">1</span>, <span class="dv">0</span>, params)   <span class="co"># T01</span></span>
<span id="cb24-251"><a href="#cb24-251" aria-hidden="true" tabindex="-1"></a>    plot_conductance(sys, Es, <span class="dv">1</span>, <span class="dv">0</span>, params)        <span class="co"># TS01</span></span>
<span id="cb24-252"><a href="#cb24-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-253"><a href="#cb24-253" aria-hidden="true" tabindex="-1"></a>    plot_SH_angle(sys, Es, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-23-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-23-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-23-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Energy = 0.100000</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-23-output-6.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="topological-hall-effect-in-a-four-terminal-device-due-to-skyrmion" class="level1">
<h1>4. Topological Hall effect in a four-terminal device due to skyrmion</h1>
<p>A magnetic texture placed on top of the tight-binding system, for instance a skyrmion, would modify its Hamiltonian</p>
<p><span class="math display">\[H = - t \sum_{\langle ij\rangle} |i\rangle\langle j| +
          \sum_{i} V_i \ \ |i\rangle\langle i|\]</span> through its onsite energy <span class="math display">\[V_i = J \ m ( r) \cdot  \sigma \]</span></p>
<p>Here, the skyrmion is given by <span class="math display">\[ m ( r) = \left(x/r \sin\theta \ , \ y/r \sin\theta \ ,\  \cos\theta \right) \]</span></p>
<p><span class="math display">\[\theta (r) = \tanh \frac{r-r_0}{\delta}\]</span></p>
<section id="plotting-the-skyrmion" class="level3">
<h3 class="anchored" data-anchor-id="plotting-the-skyrmion">4.1 Plotting the skyrmion</h3>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_skyrmion(r0<span class="op">=</span><span class="dv">15</span>, delta<span class="op">=</span><span class="dv">5</span>, nx<span class="op">=</span><span class="dv">20</span>, ny<span class="op">=</span><span class="dv">20</span>, rmax<span class="op">=</span><span class="dv">30</span>):</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    x_points <span class="op">=</span> np.linspace(<span class="op">-</span>rmax, rmax, nx)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    y_points <span class="op">=</span> np.linspace(<span class="op">-</span>rmax, rmax, ny)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> np.meshgrid(x_points, y_points)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> np.sqrt(x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    theta <span class="op">=</span> np.tanh((r0 <span class="op">-</span> r)<span class="op">/</span>delta)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    mx <span class="op">=</span> (x<span class="op">/</span>r)<span class="op">*</span>np.sin(theta)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    my <span class="op">=</span> (y<span class="op">/</span>r)<span class="op">*</span>np.sin(theta)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    mz <span class="op">=</span> np.cos(theta)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    plt.figure(dpi<span class="op">=</span><span class="dv">150</span>, figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    plt.quiver(x, y, mx, my, mz, cmap<span class="op">=</span><span class="st">'bwr'</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Magnetic texture (skyrmion)'</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'$x$'</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'$y$'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plot_skyrmion()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="computing-the-hall-resistance" class="level3">
<h3 class="anchored" data-anchor-id="computing-the-hall-resistance">5.2 Computing the Hall resistance</h3>
<p>According to the Landauer-Büttiker formula, the conductance in a four-terminal device given in the matrix form is</p>
<p><span class="math display">\[ \left(\begin{matrix} I_1 \\ I_2 \\ I_3 \\ I_4 \end{matrix} \right) =
   \left(
     \begin{matrix}
     G_{12} + G_{13} + G_{14} &amp; -G_{12} &amp; -G_{13} &amp; -G{14}  \\
     -G_{21} &amp; G_{21} + G_{23} + G_{24} &amp; -G_{23} &amp; -G_{24} \\
     -G_{31} &amp; -G_{32} &amp;  G_{31}+ G_{32} + G_{34} &amp; -G_{34} \\
     -G_{41} &amp; -G_{42} &amp;  -G_{43} &amp; G_{41} + G_{42} + G_{43}
     \end{matrix}
   \right)
   \left(
     \begin{matrix}
     V_1 \\ V_2 \\ V_3 \\ V_4
     \end{matrix}
   \right),
\]</span></p>
<p>where the leads are indexed in the clockwise direction starting from the left lead. This system is not independent because current <span class="math inline">\(I_4\)</span> can be expressed using other three currents. Also, since currents only depend on voltage differences one voltage can be set as a reference point (<span class="math inline">\(V_4 = 0\)</span>). The given system then reduces to three equations</p>
<p><span class="math display">\[ \left(\begin{matrix} I_1 \\ I_2 \\ I_3 \end{matrix} \right) =
   \left(
     \begin{matrix}
     G_{12} + G_{13} + G_{14} &amp; -G_{12} &amp; -G_{13}  \\
     -G_{21} &amp; G_{21} + G_{23} + G_{24} &amp; -G_{23}  \\
     -G_{31} &amp; -G_{32} &amp;  G_{31}+ G_{32} + G_{34}  \\
     \end{matrix}
   \right)
   \left(
     \begin{matrix}
     V_1 \\ V_2 \\ V_3
     \end{matrix}
   \right),
\]</span></p>
<p>Inverting the conductance matrix, we get the resistance matrix</p>
<p><span class="math display">\[ \left(\begin{matrix} V_1 \\ V_2 \\ V_3 \end{matrix} \right) =
   \left(
     \begin{matrix}
     R_{11} &amp; R_{12} &amp; R_{13}  \\
     R_{21} &amp; R_{22} &amp; R_{23}  \\
     R_{31} &amp; R_{32} &amp; R_{33}  \\
     \end{matrix}
   \right)
   \left(
     \begin{matrix}
     I_1 \\ I_2 \\ I_3
     \end{matrix}
   \right),
\]</span> that is <span class="math inline">\(\mathbf{V} = \mathbf{R}\mathbf{I}\)</span>, where <span class="math inline">\(\mathbf{R} = \mathbf{G}^{-1}\)</span>.</p>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> types <span class="im">import</span> SimpleNamespace</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> cos, sin, pi</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> reg</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> kwant</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> S, Eq, solve, Symbol</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>lat <span class="op">=</span> kwant.lattice.square()</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define unity and Pauli matrices</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>s_0 <span class="op">=</span> np.identity(<span class="dv">2</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>s_z <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>]])</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>s_x <span class="op">=</span> np.array([[<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">0</span>]])</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>s_y <span class="op">=</span> np.array([[<span class="dv">0</span>, <span class="op">-</span><span class="ot">1j</span>], [<span class="ot">1j</span>, <span class="dv">0</span>]])</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> HedgeHog(site, ps):</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Defines an onsite potential function in the </span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">    main scattering region due to coupling with magnetic</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">    texture.</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co">    site : site object</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="co">    ps : input parameters</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> site.pos</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span>)<span class="op">**</span><span class="fl">0.5</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    theta <span class="op">=</span> (np.pi<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span>(np.tanh((ps.r0 <span class="op">-</span> r)<span class="op">/</span>ps.delta) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> r <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>        Ex <span class="op">=</span> ((x<span class="op">/</span>r)<span class="op">*</span>np.sin(theta)<span class="op">*</span>s_x <span class="op">+</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>              (y<span class="op">/</span>r)<span class="op">*</span>np.sin(theta)<span class="op">*</span>s_y <span class="op">+</span> </span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>              np.cos(theta)<span class="op">*</span>s_z)</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>        Ex <span class="op">=</span> s_z</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">4</span><span class="op">*</span>s_0 <span class="op">+</span> ps.Ex <span class="op">*</span> Ex</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Lead_Pot(site, ps):</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>  <span class="dv">4</span><span class="op">*</span>s_0 <span class="op">+</span>  ps.Ex <span class="op">*</span> s_z</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> MakeSystem(ps, show<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    H  <span class="op">=</span> kwant.Builder()</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> shape_2DEG(pos):</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Defines a four-terminal cross region</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>        in_x <span class="op">=</span> (<span class="bu">abs</span>(x) <span class="op">&lt;</span> ps.L) <span class="kw">and</span> (<span class="bu">abs</span>(y) <span class="op">&lt;</span> ps.W)</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>        in_y <span class="op">=</span> (<span class="bu">abs</span>(x) <span class="op">&lt;</span> ps.W) <span class="kw">and</span> (<span class="bu">abs</span>(y) <span class="op">&lt;</span> ps.L)</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> in_x <span class="kw">or</span> in_y</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>    H[lat.shape(shape_2DEG,(<span class="dv">0</span>, <span class="dv">0</span>))] <span class="op">=</span> HedgeHog</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>    H[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>s_0</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define lead along the x-direction</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>    sym_x <span class="op">=</span> kwant.TranslationalSymmetry((<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>    H_lead_x <span class="op">=</span> kwant.Builder(sym_x)</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>    shape_x <span class="op">=</span> <span class="kw">lambda</span> pos: <span class="bu">abs</span>(pos[<span class="dv">1</span>])<span class="op">&lt;</span>ps.W <span class="kw">and</span> pos[<span class="dv">0</span>]<span class="op">==</span><span class="dv">0</span> </span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>    H_lead_x[lat.shape(shape_x,(<span class="dv">0</span>,<span class="dv">0</span>))] <span class="op">=</span> Lead_Pot</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>    H_lead_x[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>s_0</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define lead along the y-direction</span></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>    sym_y <span class="op">=</span> kwant.TranslationalSymmetry((<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>    H_lead_y <span class="op">=</span> kwant.Builder(sym_y)</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>    shape_y <span class="op">=</span> <span class="kw">lambda</span> pos: <span class="bu">abs</span>(pos[<span class="dv">0</span>])<span class="op">&lt;</span>ps.W <span class="kw">and</span> pos[<span class="dv">1</span>]<span class="op">==</span><span class="dv">0</span> </span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>    H_lead_y[lat.shape(shape_y,(<span class="dv">0</span>,<span class="dv">0</span>))] <span class="op">=</span> Lead_Pot </span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>    H_lead_y[lat.neighbors()] <span class="op">=</span> <span class="op">-</span>s_0</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>    H.attach_lead(H_lead_x)</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>    H.attach_lead(H_lead_y)</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>    H.attach_lead(H_lead_y.<span class="bu">reversed</span>())</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>    H.attach_lead(H_lead_x.<span class="bu">reversed</span>())</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> show:</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>        kwant.plot(H)</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> H</span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Transport(Hf, EE, ps):</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>    smatrix <span class="op">=</span> kwant.smatrix(Hf, energy<span class="op">=</span>EE, args<span class="op">=</span>[ps])</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> np.zeros((<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>): </span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>            G[i, j] <span class="op">=</span> smatrix.transmission(i, j)</span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">!=</span> j:</span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>                a <span class="op">+=</span> G[i,j]</span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>        G[i,i] <span class="op">=</span> <span class="op">-</span>a </span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> np.linalg.solve(G[:<span class="dv">3</span>,:<span class="dv">3</span>], [<span class="fl">1.</span>,<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>    Hall <span class="op">=</span> V[<span class="dv">2</span>] <span class="op">-</span> V[<span class="dv">1</span>]</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> np.linalg.solve(G[:<span class="dv">3</span>,:<span class="dv">3</span>], [<span class="fl">1.</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a>    Rxx <span class="op">=</span> V[<span class="dv">2</span>] <span class="op">-</span> V[<span class="dv">0</span>]</span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> G, Hall, Rxx</span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Define initial system parameters</span></span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a>ps <span class="op">=</span> SimpleNamespace(L<span class="op">=</span><span class="dv">45</span>, W<span class="op">=</span><span class="dv">40</span>, delta<span class="op">=</span><span class="dv">10</span>, r0<span class="op">=</span><span class="dv">20</span>, Ex<span class="op">=</span><span class="fl">1.</span>)</span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> MakeSystem(ps, show<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a>Hf <span class="op">=</span> H.finalized()</span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Vz(site):</span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a>    Hd <span class="op">=</span> HedgeHog(site,ps)</span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (Hd[<span class="dv">0</span>,<span class="dv">0</span>] <span class="op">-</span> Hd[<span class="dv">1</span>,<span class="dv">1</span>]).real </span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Vy(site):</span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a>    Hd <span class="op">=</span> HedgeHog(site, ps)</span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Hd[<span class="dv">0</span>,<span class="dv">1</span>].imag </span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a><span class="co"># kwant.plotter.map(H, Vz);</span></span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a><span class="co"># kwant.plotter.map(H, Vy);</span></span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Hall Resistance</span></span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a>ps <span class="op">=</span> SimpleNamespace(L<span class="op">=</span><span class="dv">20</span>, W<span class="op">=</span><span class="dv">15</span>, delta<span class="op">=</span><span class="dv">3</span>, r0<span class="op">=</span><span class="dv">6</span>, Ex<span class="op">=</span><span class="fl">1.</span>)</span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> MakeSystem(ps, show<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true" tabindex="-1"></a>Es <span class="op">=</span> np.linspace(<span class="fl">0.1</span>,<span class="fl">5.</span>,<span class="dv">50</span>)</span>
<span id="cb28-123"><a href="#cb28-123" aria-hidden="true" tabindex="-1"></a>Hf <span class="op">=</span> H.finalized()</span>
<span id="cb28-124"><a href="#cb28-124" aria-hidden="true" tabindex="-1"></a>dataG , dataHall, dataRxx <span class="op">=</span> [],[], []</span>
<span id="cb28-125"><a href="#cb28-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-126"><a href="#cb28-126" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> EE <span class="kw">in</span> Es: </span>
<span id="cb28-127"><a href="#cb28-127" aria-hidden="true" tabindex="-1"></a>    ps.delta <span class="op">=</span> EE</span>
<span id="cb28-128"><a href="#cb28-128" aria-hidden="true" tabindex="-1"></a>    energy <span class="op">=</span> <span class="fl">2.</span></span>
<span id="cb28-129"><a href="#cb28-129" aria-hidden="true" tabindex="-1"></a>    G, Hall, Rxx <span class="op">=</span> Transport(Hf, energy, ps)</span>
<span id="cb28-130"><a href="#cb28-130" aria-hidden="true" tabindex="-1"></a>    dataHall.append(Hall)</span>
<span id="cb28-131"><a href="#cb28-131" aria-hidden="true" tabindex="-1"></a>    dataRxx.append(Rxx)</span>
<span id="cb28-132"><a href="#cb28-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-133"><a href="#cb28-133" aria-hidden="true" tabindex="-1"></a>pyplot.plot(Es, dataHall, <span class="st">'o-'</span>, label<span class="op">=</span><span class="vs">r'$R_</span><span class="sc">{xy}</span><span class="vs">$'</span>)</span>
<span id="cb28-134"><a href="#cb28-134" aria-hidden="true" tabindex="-1"></a>pyplot.plot(Es, dataRxx, <span class="st">'o-'</span>, label<span class="op">=</span><span class="vs">r'$R_</span><span class="sc">{xx}</span><span class="vs">$'</span>)</span>
<span id="cb28-135"><a href="#cb28-135" aria-hidden="true" tabindex="-1"></a>pyplot.xlabel(<span class="st">'Domain width $\delta$'</span>)</span>
<span id="cb28-136"><a href="#cb28-136" aria-hidden="true" tabindex="-1"></a>pyplot.ylabel(<span class="st">'Hall Resistance'</span>)</span>
<span id="cb28-137"><a href="#cb28-137" aria-hidden="true" tabindex="-1"></a>pyplot.title(<span class="st">'Topologial Hall  Resistance'</span>)</span>
<span id="cb28-138"><a href="#cb28-138" aria-hidden="true" tabindex="-1"></a>pyplot.legend()<span class="op">;</span></span>
<span id="cb28-139"><a href="#cb28-139" aria-hidden="true" tabindex="-1"></a>pyplot.show()</span>
<span id="cb28-140"><a href="#cb28-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-141"><a href="#cb28-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Spin Hall angle</span></span>
<span id="cb28-142"><a href="#cb28-142" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> solvematrix4(G,I0,I2,V1,V3):</span>
<span id="cb28-143"><a href="#cb28-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># I=GxV</span></span>
<span id="cb28-144"><a href="#cb28-144" aria-hidden="true" tabindex="-1"></a>    I1, I3, V0, V2<span class="op">=</span>S(<span class="st">'I1 I3 V0 V2'</span>.split())</span>
<span id="cb28-145"><a href="#cb28-145" aria-hidden="true" tabindex="-1"></a>    equations <span class="op">=</span> [Eq(I0, G[<span class="dv">0</span>][<span class="dv">0</span>]<span class="op">*</span>V0<span class="op">+</span>G[<span class="dv">0</span>][<span class="dv">1</span>]<span class="op">*</span>V1<span class="op">+</span>G[<span class="dv">0</span>][<span class="dv">2</span>]<span class="op">*</span>V2<span class="op">+</span>G[<span class="dv">0</span>][<span class="dv">3</span>]<span class="op">*</span>V3), <span class="op">\</span></span>
<span id="cb28-146"><a href="#cb28-146" aria-hidden="true" tabindex="-1"></a>                 Eq(I1, G[<span class="dv">1</span>][<span class="dv">0</span>]<span class="op">*</span>V0<span class="op">+</span>G[<span class="dv">1</span>][<span class="dv">1</span>]<span class="op">*</span>V1<span class="op">+</span>G[<span class="dv">1</span>][<span class="dv">2</span>]<span class="op">*</span>V2<span class="op">+</span>G[<span class="dv">1</span>][<span class="dv">3</span>]<span class="op">*</span>V3), <span class="op">\</span></span>
<span id="cb28-147"><a href="#cb28-147" aria-hidden="true" tabindex="-1"></a>                 Eq(I2, G[<span class="dv">2</span>][<span class="dv">0</span>]<span class="op">*</span>V0<span class="op">+</span>G[<span class="dv">2</span>][<span class="dv">1</span>]<span class="op">*</span>V1<span class="op">+</span>G[<span class="dv">2</span>][<span class="dv">2</span>]<span class="op">*</span>V2<span class="op">+</span>G[<span class="dv">2</span>][<span class="dv">3</span>]<span class="op">*</span>V3), <span class="op">\</span></span>
<span id="cb28-148"><a href="#cb28-148" aria-hidden="true" tabindex="-1"></a>                 Eq(I3, G[<span class="dv">3</span>][<span class="dv">0</span>]<span class="op">*</span>V0<span class="op">+</span>G[<span class="dv">3</span>][<span class="dv">1</span>]<span class="op">*</span>V1<span class="op">+</span>G[<span class="dv">3</span>][<span class="dv">2</span>]<span class="op">*</span>V2<span class="op">+</span>G[<span class="dv">3</span>][<span class="dv">3</span>]<span class="op">*</span>V3)]</span>
<span id="cb28-149"><a href="#cb28-149" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> solve(equations, [I1,I3,V0,V2], <span class="bu">set</span><span class="op">=</span><span class="va">True</span>, <span class="bu">dict</span><span class="op">=</span><span class="va">False</span>, rational<span class="op">=</span><span class="va">None</span>, manual<span class="op">=</span><span class="va">True</span>, minimal<span class="op">=</span><span class="va">True</span>, particular<span class="op">=</span><span class="va">True</span>, implicit<span class="op">=</span><span class="va">False</span>, quick<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-150"><a href="#cb28-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-151"><a href="#cb28-151" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_SH_angle(fsys, energies, ps):</span>
<span id="cb28-152"><a href="#cb28-152" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> []</span>
<span id="cb28-153"><a href="#cb28-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-154"><a href="#cb28-154" aria-hidden="true" tabindex="-1"></a>    I0<span class="op">=</span><span class="dv">0</span></span>
<span id="cb28-155"><a href="#cb28-155" aria-hidden="true" tabindex="-1"></a>    I2<span class="op">=</span><span class="dv">0</span></span>
<span id="cb28-156"><a href="#cb28-156" aria-hidden="true" tabindex="-1"></a>    V1<span class="op">=</span><span class="fl">1.0</span></span>
<span id="cb28-157"><a href="#cb28-157" aria-hidden="true" tabindex="-1"></a>    V3<span class="op">=</span><span class="dv">0</span></span>
<span id="cb28-158"><a href="#cb28-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-159"><a href="#cb28-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> energy <span class="kw">in</span> energies:</span>
<span id="cb28-160"><a href="#cb28-160" aria-hidden="true" tabindex="-1"></a>        smatrix <span class="op">=</span> kwant.greens_function(fsys, energy, args<span class="op">=</span>[ps])</span>
<span id="cb28-161"><a href="#cb28-161" aria-hidden="true" tabindex="-1"></a>        G<span class="op">=</span>np.zeros((<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb28-162"><a href="#cb28-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb28-163"><a href="#cb28-163" aria-hidden="true" tabindex="-1"></a>            a<span class="op">=</span><span class="dv">0</span></span>
<span id="cb28-164"><a href="#cb28-164" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb28-165"><a href="#cb28-165" aria-hidden="true" tabindex="-1"></a>                G[i,j]<span class="op">=</span>smatrix.transmission(i, j)</span>
<span id="cb28-166"><a href="#cb28-166" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">!=</span> j: a<span class="op">+=</span>G[i,j]</span>
<span id="cb28-167"><a href="#cb28-167" aria-hidden="true" tabindex="-1"></a>            G[i,i]<span class="op">=-</span>a</span>
<span id="cb28-168"><a href="#cb28-168" aria-hidden="true" tabindex="-1"></a>        a<span class="op">=</span>solvematrix4(G,I0,I2,V1,V3)[<span class="dv">1</span>]</span>
<span id="cb28-169"><a href="#cb28-169" aria-hidden="true" tabindex="-1"></a>        result<span class="op">=</span><span class="bu">list</span>(a)</span>
<span id="cb28-170"><a href="#cb28-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-171"><a href="#cb28-171" aria-hidden="true" tabindex="-1"></a>        I1<span class="op">=</span>result[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb28-172"><a href="#cb28-172" aria-hidden="true" tabindex="-1"></a>        I3<span class="op">=</span>result[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb28-173"><a href="#cb28-173" aria-hidden="true" tabindex="-1"></a>        V0<span class="op">=</span>result[<span class="dv">0</span>][<span class="dv">2</span>]</span>
<span id="cb28-174"><a href="#cb28-174" aria-hidden="true" tabindex="-1"></a>        V2<span class="op">=</span>result[<span class="dv">0</span>][<span class="dv">3</span>]</span>
<span id="cb28-175"><a href="#cb28-175" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(I1,I3,V0,V2)</span>
<span id="cb28-176"><a href="#cb28-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-177"><a href="#cb28-177" aria-hidden="true" tabindex="-1"></a>        Gspin<span class="op">=</span>np.zeros((<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb28-178"><a href="#cb28-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb28-179"><a href="#cb28-179" aria-hidden="true" tabindex="-1"></a>            a<span class="op">=</span><span class="dv">0</span></span>
<span id="cb28-180"><a href="#cb28-180" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb28-181"><a href="#cb28-181" aria-hidden="true" tabindex="-1"></a>                ttdagger <span class="op">=</span> smatrix._a_ttdagger_a_inv(i, j)</span>
<span id="cb28-182"><a href="#cb28-182" aria-hidden="true" tabindex="-1"></a>                sigma_z_matrix <span class="op">=</span> np.kron(np.eye(<span class="bu">int</span>(<span class="bu">len</span>(ttdagger)<span class="op">/</span><span class="dv">2</span>)),s_z)    </span>
<span id="cb28-183"><a href="#cb28-183" aria-hidden="true" tabindex="-1"></a>                Gspin[i,j]<span class="op">=</span>np.trace(sigma_z_matrix.dot(ttdagger)).real</span>
<span id="cb28-184"><a href="#cb28-184" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">!=</span> j: a<span class="op">+=</span>Gspin[i,j]</span>
<span id="cb28-185"><a href="#cb28-185" aria-hidden="true" tabindex="-1"></a>            Gspin[i,i]<span class="op">=-</span>a</span>
<span id="cb28-186"><a href="#cb28-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-187"><a href="#cb28-187" aria-hidden="true" tabindex="-1"></a>        IS0<span class="op">=</span>Gspin[<span class="dv">1</span>,<span class="dv">0</span>]<span class="op">*</span>(V1<span class="op">-</span>V0)<span class="op">+</span>Gspin[<span class="dv">2</span>,<span class="dv">0</span>]<span class="op">*</span>(V2<span class="op">-</span>V0)<span class="op">+</span>Gspin[<span class="dv">3</span>,<span class="dv">0</span>]<span class="op">*</span>(V3<span class="op">-</span>V0)</span>
<span id="cb28-188"><a href="#cb28-188" aria-hidden="true" tabindex="-1"></a>        data.append(IS0<span class="op">/</span>I1)</span>
<span id="cb28-189"><a href="#cb28-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-190"><a href="#cb28-190" aria-hidden="true" tabindex="-1"></a>    pyplot.figure()</span>
<span id="cb28-191"><a href="#cb28-191" aria-hidden="true" tabindex="-1"></a>    pyplot.plot(energies, data)</span>
<span id="cb28-192"><a href="#cb28-192" aria-hidden="true" tabindex="-1"></a>    pyplot.xlabel(<span class="st">"Energy (t)"</span>)</span>
<span id="cb28-193"><a href="#cb28-193" aria-hidden="true" tabindex="-1"></a>    pyplot.ylabel(<span class="st">"Spin Hall Angle"</span>)</span>
<span id="cb28-194"><a href="#cb28-194" aria-hidden="true" tabindex="-1"></a>    pyplot.show()</span>
<span id="cb28-195"><a href="#cb28-195" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-196"><a href="#cb28-196" aria-hidden="true" tabindex="-1"></a>plot_SH_angle(Hf, Es, ps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-27-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>-6.48364913335799 6.48364913335797 0.513300899054389 0.549349094614334
-6.99396292881627 6.99396292881620 0.526946879224179 0.537608685148766
-7.15267611620984 7.15267611620990 0.512898304204094 0.546827622190681
-7.69183519537623 7.69183519537620 0.525966360373191 0.531301994303821
-7.81780346446233 7.81780346446236 0.514854137983168 0.540354444104231
-8.36144179265972 8.36144179265956 0.527973553010397 0.527193889930001
-8.50474334917862 8.50474334917865 0.517639131583068 0.532988598907662
-8.92000695518947 8.92000695518944 0.528895937895730 0.521508099874929
-9.19753778847506 9.19753778847500 0.525283409886001 0.522442660459126
-9.01334912588280 9.01334912588321 0.517562318413848 0.531247759376796
-11.5309735607951 11.5309735607953 0.538783055288450 0.499231755231223
-12.4045657714024 12.4045657714023 0.527462889325792 0.491148420696751
-13.8131533312288 13.8131533312288 0.527127631034005 0.481106260671112
-14.3179253048576 14.3179253048576 0.517109066065598 0.487978801335655
-15.1176157795629 15.1176157795627 0.523402598027012 0.489803751467204
-15.7292152375905 15.7292152375906 0.516529050704930 0.490887132629486
-17.2360005146330 17.2360005146330 0.533381022359139 0.473481097741665
-17.0539085093815 17.0539085093814 0.515655197990245 0.489687600351734
-18.6017288422801 18.6017288422802 0.533304137801175 0.471357882048543
-18.2372892616723 18.2372892616722 0.527121496073621 0.480097293261175
-20.0117392156226 20.0117392156226 0.537772969534468 0.465117763142891
-21.0993708218327 21.0993708218326 0.548083341771187 0.455791413543471
-21.4203833498941 21.4203833498943 0.543488781914165 0.459102783332368
-22.6433357010037 22.6433357010036 0.556902041477898 0.445172201138467
-23.3583417596611 23.3583417596612 0.561015251373542 0.441994107901768
-24.0181752852916 24.0181752852917 0.563384173040116 0.438835163185671
-24.9433055092016 24.9433055092018 0.570808159015347 0.431752389296760
-26.0261267937582 26.0261267937585 0.584116351998696 0.419838428911735
-26.9559758926820 26.9559758926820 0.594091507686157 0.409158833934541
-28.2517909532557 28.2517909532665 0.603265699436267 0.375931221283636
-27.6417129188005 27.6417129188006 0.573487584778594 0.382350557713248
-26.8785272677680 26.8785272677680 0.560226216050541 0.396278601159382
-26.9277099722418 26.9277099722418 0.557607462803868 0.398916762835527
-26.1805467748379 26.1805467748381 0.546167159382791 0.410749160080718
-26.7393766598592 26.7393766598590 0.551275210040803 0.405843891975529
-26.1698259136871 26.1698259136872 0.540861626418620 0.416601886188596
-26.1972022169084 26.1972022169084 0.541234150884639 0.417450710558651
-26.0236854124570 26.0236854124570 0.539692943235899 0.418575057998677
-26.2046200294019 26.2046200294021 0.540092882129687 0.418823348412297
-25.1964887432945 25.1964887432946 0.529686237841447 0.428774851716250
-26.2046200294019 26.2046200294022 0.540092882129687 0.418823348412298
-26.0236854124572 26.0236854124568 0.539692943235895 0.418575057998678
-26.1972022169085 26.1972022169085 0.541234150884637 0.417450710558652
-26.1698259136869 26.1698259136871 0.540861626418622 0.416601886188597
-26.7393766598590 26.7393766598590 0.551275210040811 0.405843891975532
-26.1805467748381 26.1805467748380 0.546167159382786 0.410749160080715
-26.9277099722418 26.9277099722418 0.557607462803866 0.398916762835526
-26.8785272677678 26.8785272677680 0.560226216050542 0.396278601159381
-27.6417129188007 27.6417129188006 0.573487584778591 0.382350557713247
-28.2517911935212 28.2517911935212 0.603265701443200 0.375931218725270</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="nanostructures_out_of_equilibrium_with_kwant_files/figure-html/cell-27-output-4.png" class="img-fluid"></p>
</div>
</div>
<p>Please send corrections to <code>petrovic@udel.edu</code></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>